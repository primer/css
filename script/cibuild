#!/bin/bash
set -e

# --yes gets passed in by .travis.yml,
# which makes this easier to test locally
args=${@:1}
package=primer-css

# always publish a canary release if this is a PR build
if [[ $TRAVIS_EVENT_TYPE = pull_request ]]; then
  echo "ğŸ¦  Publishing canary version..."
  npm run release-canary -- ${args}
  version=`jq -r .version modules/${package}/package.json`
  echo "ğŸ“¡  Transmitting release success for ${package}@${version} ..."
  TRAVIS_COMMIT=$TRAVIS_PULL_REQUEST_SHA \
    commit-status success npm/publish/pr "npm install ${package}@${version}"
# merges to dev build a release candidate
elif [[ $TRAVIS_BRANCH = dev ]]; then
  echo "ğŸ‘Œ  Publishing release candidate..."
  echo npm run release-candidate -- ${args}
# publish a release when we merge to master
elif [[ $TRAVIS_BRANCH = master ]]; then
  echo "ğŸ“¦  Publishing latest release!"
  echo npm run release -- ${args}
else
  echo "âš ï¸  This isn't a PR and '${TRAVIS_BRANCH}' isn't a release branch."
  exit 1
fi
