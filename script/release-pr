#!/bin/bash
set -e
echo "üê¶  Publishing PR (canary) release..."

# don't notify of a pending publish event because the version will differ from
# what lerna creates as a canary release
# $(dirname $0)/notify pending

$(npm bin)/lerna publish --npm-tag=pr --canary --exact $@

$(dirname $0)/notify success

package=primer-css
version=$(jq -r .version modules/$package/package.json)
slug="$package@$version"
backticks='```'
text="*<https://unpkg.com/$slug|$slug> is built!*\n\nYou can test it with:\n${backticks}npm install ${slug}${backticks}\nOr in github/github:\n${backticks}./bin/npm install $slug${backticks}",

$(dirname $0)/notify-slack -u npm -i npm "$text"
