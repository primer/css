// component id

$Layout: 'PageLayout' !default;
$Layout-divider-color: red !default; // var(--color-border-default)
$Layout-responsive-variant-max-breakpoint: 'md';

// Prop names

// dividers
$Layout-prop-pane-divider: 'has-pane-divider' !default;
$Layout-prop-header-divider: 'has-header-divider' !default;
$Layout-prop-footer-divider: 'has-footer-divider' !default;

// pane region
$Layout-prop-pane-position: 'pane-position' !default;
$Layout-prop-pane-width: 'pane-width' !default;
$Layout-prop-pane-is-sticky: 'is-pane-sticky' !default;

// content region
$Layout-prop-content-width: 'content-width' !default;

// stackRegions-specific variants
$Layout-prop-stackRegions-pane-position: 'stackRegions-pane-position' !default;

// separateRegions-specific variants
$Layout-prop-separateRegions-primary-region: 'primary' !default;

:root {
  --Layout-pane-width: #{map-get($sidebar-width, 'sm')};
  --Layout-content-width: 100%;
  // stylelint-disable-next-line primer/no-undefined-vars
  --Layout-template-columns: 1fr var(--Layout-pane-width);
  --Layout-template-areas: 'content pane';
  --Layout-column-gap: #{$spacer-3};
  --Layout-row-gap: #{$spacer-3};

  // the `px` unit is mandatory for `calc()` execution. See https://stackoverflow.com/a/32518348
  // stylelint-disable length-zero-no-unit
  --Layout-outer-spacing-x: 0px; // wrapper margin x
  --Layout-outer-spacing-y: 0px; // wrapper margin y

  --Layout-inner-spacing-min: 0px; // default region padding
  --Layout-inner-spacing-max: 0px; // relaxed content horizontal padding
  // stylelint-enable length-zero-no-unit
}

.#{$Layout} {
  // stylelint-disable-next-line primer/spacing
  margin: var(--Layout-outer-spacing-y) var(--Layout-outer-spacing-x);

  > .#{$Layout}-wrapper {
    display: grid;
    grid: auto-flow / 1fr;
    row-gap: var(--Layout-row-gap);

    > .#{$Layout}-columns {
      display: grid;
      column-gap: var(--Layout-column-gap);
      row-gap: var(--Layout-row-gap);
      grid-template-columns: var(--Layout-template-columns);
      grid-template-rows: 1fr;
      grid-template-areas: var(--Layout-template-areas);
    }
  }

  // outer spacing

  &.#{$Layout}--outer-spacing-normal {
    --Layout-outer-spacing-x: #{$spacer-3}; // 16px
    --Layout-outer-spacing-y: #{$spacer-3}; // 16px

    @include breakpoint(lg) {
      --Layout-outer-spacing-x: #{$spacer-4}; // 24px
      --Layout-outer-spacing-y: #{$spacer-4}; // 24px
    }
  }

  &.#{$Layout}--outer-spacing-condensed {
    --Layout-outer-spacing-x: #{$spacer-3}; // 16px
    --Layout-outer-spacing-y: #{$spacer-3}; // 16px
  }

  // inner spacing

  &.#{$Layout}--inner-spacing-normal {
    --Layout-inner-spacing-min: #{$spacer-3}; // 16px
    --Layout-inner-spacing-max: #{$spacer-3}; // 16px

    @include breakpoint(lg) {
      --Layout-inner-spacing-max: #{$spacer-4}; // 24px
    }
  }

  &.#{$Layout}--inner-spacing-condensed {
    --Layout-inner-spacing-min: #{$spacer-3}; // 16px
    --Layout-inner-spacing-max: #{$spacer-3}; // 16px
  }

  // column gap

  &.#{$Layout}--column-gap-normal {
    --Layout-column-gap: #{$spacer-3}; // 16px

    @include breakpoint(lg) {
      --Layout-column-gap: #{$spacer-4}; // 24px
    }
  }

  &.#{$Layout}--column-gap-condensed {
    --Layout-column-gap: #{$spacer-3}; // 16px
  }

  &.#{$Layout}--column-gap-none {
    // the `px` unit is mandatory for `calc()` execution. See https://stackoverflow.com/a/32518348
    // stylelint-disable-next-line length-zero-no-unit
    --Layout-column-gap: 0px;
  }

  // row gap

  &.#{$Layout}--row-gap-normal {
    --Layout-row-gap: #{$spacer-3}; // 16px

    @include breakpoint(lg) {
      --Layout-row-gap: #{$spacer-4}; // 24px
    }
  }

  &.#{$Layout}--row-gap-none {
    // the `px` unit is mandatory for `calc()` execution. See https://stackoverflow.com/a/32518348
    // stylelint-disable length-zero-no-unit
    --Layout-row-gap: 0px;
  }

  &.#{$Layout}--row-gap-condensed {
    --Layout-row-gap: #{$spacer-3}; // 16px
  }

  // regions

  .#{$Layout}-header, .#{$Layout}-content, .#{$Layout}-pane, .#{$Layout}-footer {
    // stylelint-disable-next-line primer/spacing
    padding: var(--Layout-inner-spacing-min);
  }
  
  .#{$Layout}-header {
    background: lightpink;
  }

  .#{$Layout}-content {
    // stylelint-disable primer/spacing
    padding-left: var(--Layout-inner-spacing-max);
    padding-right: var(--Layout-inner-spacing-max);
    // stylelint-enable primer/spacing
    grid-area: content;
    background: rgb(255, 197, 253);
  }

  .#{$Layout}-pane {
    grid-area: pane;
    background: rgb(215, 255, 233);
  }

  .#{$Layout}-footer {
    background: lightyellow;
  }

  // multi-column desktop-friendly layout

  @include breakpoint($Layout-responsive-variant-max-breakpoint) {

    // Set a `content` region width, to work with loading states when
    // `pane` is not yet loaded. See https://github.com/primer/css/pull/1818
    $Layout-content-full-width: minmax(0, calc(100% - var(--Layout-pane-width) - var(--Layout-column-gap)));

    &.#{$Layout}--pane-position-start {
      --Layout-template-columns: var(--Layout-pane-width) #{$Layout-content-full-width};
      --Layout-template-areas: "pane content";
    }

    &.#{$Layout}--pane-position-end {
      --Layout-template-columns: #{$Layout-content-full-width} var(--Layout-pane-width);
      --Layout-template-areas: "content pane";
    }

    // header divider

    &.#{$Layout}--#{$Layout-prop-header-divider} {
      .#{$Layout}-header {
        padding-bottom: max(var(--Layout-row-gap), var(--Layout-inner-spacing-min));
        border-bottom: 1px solid $Layout-divider-color;
      }
    }

    // footer divider

    &.#{$Layout}--#{$Layout-prop-footer-divider} {
      .#{$Layout}-footer {
        padding-top: max(var(--Layout-row-gap), var(--Layout-inner-spacing-min));
        border-top: 1px solid $Layout-divider-color;
      }
    }


    // pane divider

    &.#{$Layout}--#{$Layout-prop-pane-divider} {
      &.#{$Layout}--pane-position-start {
        .#{$Layout}-pane {
          border-right: 1px solid $Layout-divider-color;
        }

        &:not(.#{$Layout}--column-gap-none) {
          .#{$Layout}-pane {
            margin-right: calc(var(--Layout-column-gap) * -1);
            padding-right: calc(var(--Layout-column-gap) - 1px);
          }
          .#{$Layout}-content {
            margin-left: var(--Layout-column-gap);
          }
        }
      }

      &.#{$Layout}--pane-position-end {
        .#{$Layout}-pane {
          border-left: 1px solid $Layout-divider-color;
        }

        &:not(.#{$Layout}--column-gap-none) {
          .#{$Layout}-pane {
            margin-left: calc(var(--Layout-column-gap) * -1);
            padding-left: calc(var(--Layout-column-gap) - 1px); 
          }
          .#{$Layout}-content {
            margin-right: var(--Layout-column-gap);
          }
        }
      }
    }

    // sticky pane

    &.#{$Layout}--is-pane-sticky {
      .#{$Layout}-pane {
        position: sticky;
        top: 0;
        max-height: 100vh;
        overflow: auto;
      }
    }

    // content width

    [class^="#{$Layout}-content-centered-"] {
      max-width: calc(var(--Layout-content-width) + var(--Layout-pane-width) + var(--Layout-column-gap));
      margin-right: auto;
      margin-left: auto;
    }

    &.#{$Layout}--#{$Layout-prop-pane-divider} {
      [class^="#{$Layout}-content-centered-"] {
        max-width: calc(var(--Layout-content-width) + var(--Layout-pane-width) + (var(--Layout-column-gap) * 2));
      }
    }

    &.#{$Layout}--pane-position-start {
      [class^="#{$Layout}-content-centered-"] > [class^='container-'] {
        margin-left: 0;
      }
    }

    &.#{$Layout}--pane-position-end {
      [class^="#{$Layout}-content-centered-"] > [class^='container-'] {
        margin-right: 0;
      }
    }

    @each $breakpoint in map-keys($breakpoints) {
      .#{$Layout}-content-centered-#{$breakpoint} {
        --Layout-content-width: #{map-get($breakpoints, $breakpoint)};
      }
    }

    // pane width

    @each $breakpoint in map-keys($sidebar-width) {
      @include breakpoint($breakpoint) {
        --Layout-pane-width: #{map-get($sidebar-width, $breakpoint)};
      }
    }

    &.#{$Layout}--#{$Layout-prop-pane-width}-narrow {
      @each $breakpoint in map-keys($sidebar-narrow-width) {
        @include breakpoint($breakpoint) {
          --Layout-pane-width: #{map-get($sidebar-narrow-width, $breakpoint)};
        }
      }
    }

    &.#{$Layout}--#{$Layout-prop-pane-width}-wide {
      @each $breakpoint in map-keys($sidebar-wide-width) {
        @include breakpoint($breakpoint) {
          --Layout-pane-width: #{map-get($sidebar-wide-width, $breakpoint)};
        }
      }
    }
  }

  // responsive variants

  @media (max-width: #{map-get($breakpoints, $Layout-responsive-variant-max-breakpoint) - 0.02px}) {

    // variant: stackRegions

    &.#{$Layout}--variant-stackRegions {
      --Layout-template-columns: 1fr;
  
      // responsive-pane-position: end (default)
      --Layout-template-areas: 'content' 'pane';
  
      // responsive-pane-position: start
      &.#{$Layout}--#{$Layout-prop-stackRegions-pane-position}-start {
        --Layout-template-areas: 'pane' 'content';
      }
    }

    // variant: separateRegions

    &.#{$Layout}--variant-separateRegions {
      --Layout-template-columns: 1fr;
      --Layout-template-areas: 'content';

      &.#{$Layout}--#{$Layout-prop-separateRegions-primary-region}-content {
        --Layout-template-areas: 'content';
        .#{$Layout}-pane {
          display: none;
        }
      }

      &.#{$Layout}--#{$Layout-prop-separateRegions-primary-region}-pane {
        --Layout-template-areas: 'pane';
        .#{$Layout}-content {
          display: none;
        }
      }
    }

    // region dividers for responsive variants

    .#{$Layout}-region--hasDivider-line-before {
      position: relative;
      margin-top: var(--Layout-row-gap);
    
      &:before {
        @include Layout-line-divider;
        top: calc(-1px - var(--Layout-row-gap));
      }
    }
    
    .#{$Layout}-region--hasDivider-line-after {
      position: relative;
      margin-bottom: var(--Layout-row-gap);
    
      &:after {
        @include Layout-line-divider;
        bottom: calc(-1px - var(--Layout-row-gap));
      } 
    }
    
    .#{$Layout}-region--hasDivider-filled-before {
      position: relative;
      margin-top: calc(#{$spacer-2} + var(--Layout-row-gap));
    
      &:after {
        @include Layout-filled-divider;
        top: calc(#{$spacer-2 * -1} - var(--Layout-row-gap));
      }
    }
    
    .#{$Layout}-region--hasDivider-filled-after {
      position: relative;
      margin-bottom: calc(#{$spacer-2} + var(--Layout-row-gap));
    
      &:before {
        @include Layout-filled-divider;
        bottom: calc(#{$spacer-2 * -1} - var(--Layout-row-gap));
      }
    }
  }

}